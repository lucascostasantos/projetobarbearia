<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Perfil do Usuário</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body style="background-color: rgba(37, 36, 36, 1); height: 100vh;">
  <div class="container d-flex justify-content-center align-items-center" style="height: 100vh;">
    <div style="background-color: black; padding: 30px; border-radius: 10px; color: white; width: 80%; max-width: 1000px;">
      <div class="row align-items-center">

        <!-- Informações do Perfil -->
        <div class="col-md-9">
          <h3 class="mb-3">Perfil do Usuário</h3>
          <form id="updateform" method="POST" action="/usuarios/{{usuario.id}}">
            <input type="hidden" name="_method" value="PUT" />
            <div class="mb-3">
              <label for="nome" class="form-label">Nome</label>
              <div class="input-group">
                <input type="text" class="form-control" id="nome" name="nome" value="{{usuario.nome}}" disabled />
                <span class="input-group-text" style="background-color: transparent; border: none;">
                  <svg id="editNome" onclick="ativarEdicao('nome', 'editNome')" xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" color="white" class="bi bi-box-arrow-in-down-left" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M9.636 2.5a.5.5 0 0 0-.5-.5H2.5A1.5 1.5 0 0 0 1 3.5v10A1.5 1.5 0 0 0 2.5 15h10a1.5 1.5 0 0 0 1.5-1.5V6.864a.5.5 0 0 0-1 0V13.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>
                    <path fill-rule="evenodd" d="M5 10.5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 0-1H6.707l8.147-8.146a.5.5 0 0 0-.708-.708L6 9.293V5.5a.5.5 0 0 0-1 0z"/>
                  </svg>
                </span>
              </div>
            </div>

            <div class="mb-3">
              <label for="email" class="form-label">Email</label>
              <div class="input-group">
                <input type="text" class="form-control" id="email" name="email" value="{{usuario.email}}" disabled />
                <span class="input-group-text" style="background-color: transparent; border: none;">
                  <svg id="editEmail" onclick="ativarEdicao('email', 'editEmail')"  xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" color="white" class="bi bi-box-arrow-in-down-left" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M9.636 2.5a.5.5 0 0 0-.5-.5H2.5A1.5 1.5 0 0 0 1 3.5v10A1.5 1.5 0 0 0 2.5 15h10a1.5 1.5 0 0 0 1.5-1.5V6.864a.5.5 0 0 0-1 0V13.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>
                    <path fill-rule="evenodd" d="M5 10.5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 0-1H6.707l8.147-8.146a.5.5 0 0 0-.708-.708L6 9.293V5.5a.5.5 0 0 0-1 0z"/>
                  </svg>
                </span>
              </div>
            </div>

            <div class="mb-3">
              <label for="telefone" class="form-label">Telefone</label>
              <div class="input-group">
                <input type="text" class="form-control" id="telefone" name="telefone" value="{{usuario.telefone}}" disabled />
                <span class="input-group-text" style="background-color: transparent; border: none;">
                  <svg id="editTelefone" onclick="ativarEdicao('telefone', 'editTelefone')" xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" color="white" class="bi bi-box-arrow-in-down-left" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M9.636 2.5a.5.5 0 0 0-.5-.5H2.5A1.5 1.5 0 0 0 1 3.5v10A1.5 1.5 0 0 0 2.5 15h10a1.5 1.5 0 0 0 1.5-1.5V6.864a.5.5 0 0 0-1 0V13.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>
                    <path fill-rule="evenodd" d="M5 10.5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 0-1H6.707l8.147-8.146a.5.5 0 0 0-.708-.708L6 9.293V5.5a.5.5 0 0 0-1 0z"/>
                  </svg>
                </span>
              </div>
            </div>

            <div class="mb-3">
              <label for="senha" class="form-label">Senha</label>
              <div class="input-group">
                <input type="password" class="form-control" id="senha" name="senha" placeholder="Digite uma nova senha" disabled />
                <span class="input-group-text" style="background-color: transparent; border: none;">
                  <svg id="editSenha" onclick="ativarEdicao('senha', 'editSenha')" xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="currentColor" color="white" class="bi bi-box-arrow-in-down-left" viewBox="0 0 16 16">
                    <path fill-rule="evenodd" d="M9.636 2.5a.5.5 0 0 0-.5-.5H2.5A1.5 1.5 0 0 0 1 3.5v10A1.5 1.5 0 0 0 2.5 15h10a1.5 1.5 0 0 0 1.5-1.5V6.864a.5.5 0 0 0-1 0V13.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>
                    <path fill-rule="evenodd" d="M5 10.5a.5.5 0 0 0 .5.5h5a.5.5 0 0 0 0-1H6.707l8.147-8.146a.5.5 0 0 0-.708-.708L6 9.293V5.5a.5.5 0 0 0-1 0z"/>
                  </svg>
                </span>
              </div>
            </div>

            <button type="submit" class="btn btn" style="background-color: rgb(255, 94, 0);">Salvar Alterações</button>
            <a href="/logout" class="btn btn" style="background-color: rgb(255, 94, 0); width: 100px;">Sair</a>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script>

    function ativarEdicao(inputId, editarIconId) {
      const input = document.getElementById(inputId);
      const editarIcon = document.getElementById(editarIconId);

      if (input.disabled) {
        input.disabled = false; // Habilita o campo para edição
        editarIcon.classList.add('d-none'); // Esconde o ícone
      } else {
        input.disabled = true; // Desabilita o campo
        editarIcon.classList.remove('d-none'); // Mostra o ícone
      }
    }

    document.getElementById('updateform').addEventListener('submit', function(event) {
      event.preventDefault(); // Previne o envio padrão do formulário

      const inputs = document.querySelectorAll('#updateform input');
      inputs.forEach(input => input.disabled = false); // Habilita todos os campos antes de enviar

      let form = event.target;
      let formData = new FormData(form);

      let formDataObj = Object.fromEntries(formData.entries());
      console.log(formDataObj);
      formDataObj._method = 'PUT'; // Adiciona o método PUT

      fetch(form.action, {
        method: 'POST', // Usa POST para evitar bloqueios
        body: JSON.stringify(formDataObj),
        headers: {
          'Content-Type': 'application/json'
        }
      })
      .then(response => {
        console.log(response);
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        return response.json();
      })
      .then(data => {
        alert('Dados atualizados com sucesso!');
        console.log('Success:', data);
        location.reload(); // Recarrega a página após salvar
      })
      .catch(error => {
        alert('Erro ao atualizar os dados.');
        console.error('Error:', error.message);
      });
    });

    function toggleSalvarAlteracoes() {
      const inputs = document.querySelectorAll('#updateform input');
      const botaoSalvar = document.querySelector('button[type="submit"]');

      const camposEditaveis = Array.from(inputs).some(input => !input.disabled);

      if (camposEditaveis) {
        botaoSalvar.style.backgroundColor = 'green'; // Muda a cor do botão
        botaoSalvar.textContent = 'Salvar Alterações';
      } else {
        botaoSalvar.style.backgroundColor = 'rgb(255, 94, 0)'; // Volta à cor original
        botaoSalvar.textContent = 'Salvar Alterações';
      }
    }

    // Detecta alterações nos campos
    document.querySelectorAll('#updateform input').forEach(input => {
      input.addEventListener('input', toggleSalvarAlteracoes);
    });




  </script>


  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
